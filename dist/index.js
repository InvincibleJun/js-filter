!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).JsFilter=t()}(this,function(){"use strict";function r(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function f(e,t,a,r,n,i){if(0===i)return e[t][a];for(var o,u,s,c=n<a+i?n:a+i,h=a-i<0?0:a-i,f=0,l=0,g=0,v=t-i<0?0:t-i,p=r<t+i?r:t+i;v<=p;v++)for(var d=h,m=c;d<=m;d++){var b=e[v][d],y=b.r,w=b.g,k=b.b,I=(b.a,o=d-a,u=v-t,s=i,1/(2*Math.PI*s*s)*Math.pow(Math.E,-(o*o+u*u)/(2*s*s)));f+=Math.abs(I)*y,l+=Math.abs(I)*w,g+=Math.abs(I)*k}return{r:parseInt(f,10),g:parseInt(l,10),b:parseInt(g,10),a:255}}function i(e,t,a,r){for(var n=function(e,t){for(var a=Array.from(e).reduce(function(e,t,a){switch(a%4){case 1:e[e.length-1].g=t;break;case 2:e[e.length-1].b=t;break;case 3:e[e.length-1].a=t;break;default:e.push({r:t,g:0,b:0,a:0})}return e},[]),r=[],n=0,i=a.length;n<i;n++){var o=Math.floor(n/t);r[o]?r[o].push(a[n]):r[o]=[a[n]]}return r}(e,t),i=[],o=0,u=n.length;o<u;o++)for(var s=0,c=n[o].length;s<c;s++){var h=f(n,o,s,u-1,c-1,r);i.push(h.r),i.push(h.g),i.push(h.b),i.push(h.a)}return i}function o(e){for(var t=[],a=0,r=e.length;a<r;a++)t.push(a%4!=3?255-e[a]:e[a]);return t}function u(e){for(var t=[],a=0,r=e.length;a<r;a++)switch(a%4){case 0:t.push(.393*e[a]+.769*e[a+1]+.189*e[a+2]);break;case 1:t.push(.349*e[a-1]+.686*e[a]+.168*e[a+1]);break;case 2:t.push(.272*e[a-2]+.534*e[a-1]+.131*e[a]);break;default:t.push(e[a])}return t}function s(e){for(var t=[],a=0,r=e.length;a<r;a+=4){var n=(e[a]+e[a+1]+e[a+2])/3;t.push(n,n,n,e[a+3])}return t}function c(e,t,a){for(var r=[],n=0,i=e.length;n<i;n+=4)r.push(e[n+4]-e[n]+128,e[n+5]-e[n+1]+128,e[n+6]-e[n+2]+128,e[n+3]);return r}return function(){function a(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{type:"base64"};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),n(this,"el",void 0),n(this,"option",void 0),n(this,"type",void 0),n(this,"methods",{gauss:i,base:o,brown:u,grey:s,emboss:c}),this.el=e,this.option=t,this.type=t.type,this.init()}return function(e,t,a){t&&r(e.prototype,t),a&&r(e,a)}(a,[{key:"init",value:function(){}},{key:"loadImage",value:function(e,n,t){var i=this,o=2<arguments.length&&void 0!==t?t:function(){};return new Promise(function(t,a){try{var r=new Image;r.crossOrigin="anonymous",r.src=e,r.onload=function(){var e=i.render(n,r,r.width,r.height);t(),o(null,e)}}catch(e){a(e),o(e)}})}},{key:"render",value:function(e,t,a,r){var n=document.createElement("canvas"),i=n.getContext("2d");n.width=a,n.height=r,i.drawImage(t,0,0);var o=i.getImageData(0,0,a,r);i.clearRect(0,0,n.width,n.height);var u=this.makeImageData(o.data,a,r,e);return i.putImageData(u,0,0),this.callback(n,i)}},{key:"callback",value:function(e){switch(this.type){case"base64":return e.toDataURL("image/png");case"canvas":return e;case"img":return this.createImage(e.toDataURL("image/png"));default:return e}}},{key:"makeImageData",value:function(e,t,a,r){var n=r.method,i=r.blur,o=void 0===i?2:i,u=this.methods[n];if(!u)throw new Error("不存在该方法".concat(n));var s=new Uint8ClampedArray(u(e,t,a,o));return new ImageData(s,t,a)}},{key:"createImage",value:function(e){var t=document.createElement("img");return t.setAttribute("src",e),t}}]),a}()});
